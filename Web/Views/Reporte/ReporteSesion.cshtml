@{ Infraestructure.Models.Usuario UsuarioLogueado = (Infraestructure.Models.Usuario)Session["User"]; }
@{
    ViewBag.Title = "Reporte Sesión";
}






<!-- Content Header (Page header) -->
<div class="content-header">
    <div class="container-fluid">
        <div class="row mb-2">
            <div class="col-sm-6">
                <h3>Reportes</h3>
            </div><!-- /.col -->
            <div class="col-sm-6">
                <ol class="breadcrumb float-sm-right">
                    <li class="breadcrumb-item"><a href="@Url.Action("Index","Home")">Inicio</a></li>
                    <li class="breadcrumb-item active">Reporte</li>
                </ol>
            </div><!-- /.col -->
        </div><!-- /.row -->
    </div><!-- /.container-fluid -->
</div>




<div id="container-fluid">
    <div class="row">
        <div class="col">
            <p class="tooltip--right float-left" data-tooltip="Genera un reporte de las sesiones de los usuarios">
                <button class="btn btn-primary" onclick="Descargar()">
                    <i class="glyphicon glyphicon-download"></i> Descargar Reporte
                </button>
            </p>
        </div>
        <div class="col text-center">

        </div>
        <div class="col">
            <p class="tooltip--left float-right" data-tooltip="Elimina permanentemente todos los registros de sesiones.">
                <a class="btn btn-danger" onclick="eliminar()">
                    <i class="fas fa-trash mr-2"></i>
                    Eliminar todo
                </a>
            </p>
        </div>
    </div>
</div>




<iframe id="frmReporte" width="100%" height="550px" frameborder="0" scrolling="no">
</iframe>



@section scripts {




    <script>

        function Descargar() {
            window.open("/Reporte/DescargarReporteSesion");
        }

        function Mostrar() {

            $("#frmReporte")
                .attr("src", "/Reporte/DescargarReporteSesion")
                .load();
        }



        $(document).ready(function () {

            Mostrar();
                // Recibe los parámetros del Controller
                var option = '@TempData["Action"]'
                var message = '@TempData["Message"]'



                if (option == 'S') {
                    Swal.fire('Éxito!',
                        'El registro fue salvado correctamente.',
                        'success');
                }


                 if (option == 'D') {
                     Swal.fire('Éxito!',
                         'El registro fue desactivado correctamente.',
                         'success');
                }


                 if (option == 'U') {
                     Swal.fire('Éxito!',
                         'El registro fue actualizado correctamente.',
                         'success');
                }

            if (option == 'E') {
                Swal.fire('Error!',
                    'Se ha producido un error: '+message,
                    'error');
            }
        });



    </script>




    <script>
        //AQUI PARA PONER ACTIVO EL NAV-LINK, PONERSE EN CADA PAGINA
        $(document).ready(function () {
            $("#mantenimientos").addClass('active');
            $("#menucategorias").addClass('active');

        });




    </script>


    <script>





        function eliminar() {
            Swal.fire({
                title: 'Estás seguro?',
                text: "Se eliminarán todos los registros de acceso del sistema. Esto no pone en peligro la integridad de los datos de los usuarios",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Sí, elimínalos!',
                cancelButtonText: 'Cancelar'
            }).then((result) => {
                if (result.isConfirmed) {
                    $.ajax({
                        type: "POST",
                        url: '/Reporte/BorrarBitacorasSesion',
                        success: function () {

                            location.reload();
                        },
                        error: function (xhr, status, error) {
                            location.reload();
                        }
                    })


                }
            })
        }
    </script>


}
